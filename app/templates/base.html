<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />

  <!-- ‚úÖ PWA / Mobile viewport fix -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- ‚úÖ Theme -->
  <meta name="theme-color" content="#0b1220" />

  <!-- ‚úÖ iOS PWA support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="SuperFlow" />

  <!-- ‚úÖ Android PWA hint -->
  <meta name="mobile-web-app-capable" content="yes" />

  <title>{{ title or "SuperFlow" }}</title>

  <!-- ‚úÖ Manifest -->
  <link rel="manifest" href="{{ url_for('static', filename='pwa/manifest.json') }}">

  <!-- ‚úÖ Favicons / PWA icons (‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏£‡∏¥‡∏á) -->
  <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/superflow-appicon-192.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/superflow-appicon-192.png') }}">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">

  <!-- ‚úÖ Emergency CSS fix + SuperFlow Hero Header -->
  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-right: env(safe-area-inset-right);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);

      /* ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å set ‡πÇ‡∏î‡∏¢ JS ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
      --app-vh: 1vh;
    }

    html, body{
      height: auto;
      min-height: 100%;
    }

    body{
      min-height: 100dvh; /* modern mobile */
      padding-bottom: var(--safe-bottom);
      -webkit-text-size-adjust: 100%;
    }

    /* ‡∏ñ‡πâ‡∏≤ topbar ‡πÄ‡∏õ‡πá‡∏ô fixed/sticky ‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏ö‡∏ô iOS */
    .topbar{
      padding-top: var(--safe-top);
    }

    /* Container ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ä‡∏ô safe area ‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤ */
    .container{
      padding-left: max(16px, var(--safe-left));
      padding-right: max(16px, var(--safe-right));
    }

    /* ‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏ô/‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ö‡∏≤‡∏á‡∏£‡∏∏‡πà‡∏ô */
    body.drawer-open{
      overscroll-behavior: none;
      touch-action: manipulation;
    }

    /* ===== SuperFlow Hero Header (Glass) ===== */
    .topbar--hero{
      position: sticky;
      top: 0;
      z-index: 60;

      /* ‚úÖ glass effect */
      background: rgba(11, 18, 32, .55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);

      border-bottom: 1px solid rgba(255,255,255,.08);
    }

    .topbar__inner--center{
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      min-height: 130px; /* ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÉ‡∏´‡∏ç‡πà */
      padding: 12px 0;
    }

    /* ‡∏î‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏° hamburger ‡πÑ‡∏õ‡∏ã‡πâ‡∏≤‡∏¢ */
    .topbar__inner--center .hamburger{
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
    }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Å‡∏•‡∏≤‡∏á */
    .hero-brand{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-align: center;
      padding: 4px 12px;
    }

    /* ‡πÇ‡∏•‡πÇ‡∏Å‡πâ (‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô ~3 ‡πÄ‡∏ó‡πà‡∏≤) */
    .hero-brand__img{
      height: 130px;
      max-width: 720px;
      object-fit: contain;
      display: block;
    }

    /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
    .hero-brand__tagline{
      font-size: 13px;
      color: rgba(230,238,252,.75);
      letter-spacing: .2px;
      line-height: 1.2;
    }

    /* Mobile */
    @media (max-width: 480px){
      .topbar__inner--center{
        min-height: 120px;
      }
      .hero-brand__img{
        height: 96px;
        max-width: 90%;
      }
      .hero-brand__tagline{
        font-size: 12px;
      }
    }

    /* ‚úÖ ‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ topbar */
.drawer-backdrop{
  z-index: 120;   /* ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ topbar (60) */
}

.drawer{
  z-index: 130;   /* ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ backdrop */
}

/* (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ‡∏ñ‡πâ‡∏≤‡∏ö‡∏≤‡∏á‡∏ó‡∏µ topbar ‡∏¢‡∏±‡∏á‡∏ó‡∏±‡∏ö ‡πÉ‡∏´‡πâ‡∏•‡∏î‡∏°‡∏±‡∏ô‡∏•‡∏á */
.topbar--hero{
  z-index: 50;
}

  </style>

  {% block head %}{% endblock %}
</head>

<body>
  <!-- Drawer backdrop -->
  <div class="drawer-backdrop" data-drawer-close></div>

  <!-- Drawer (‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏°) -->
  <aside class="drawer" aria-label="‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å" aria-hidden="true">
    <div class="drawer__head">
      <div class="drawer__brand">
        <!-- ‚úÖ ‡πÉ‡∏ä‡πâ app icon ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì -->
        <img src="{{ url_for('static', filename='icons/superflow-appicon-192.png') }}" alt="SuperFlow" class="drawer__icon">
        <div>
          <div class="drawer__title">SuperFlow</div>
          <div class="drawer__subtitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</div>
        </div>
      </div>
      <button class="drawer__close" type="button" aria-label="‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π" data-drawer-close>‚úï</button>
    </div>

    <nav class="drawer__nav">
      <a class="drawer__link {{ 'is-active' if request.path.startswith('/projects') else '' }}" href="{{ url_for('pages.project_list') }}">
        <span class="drawer__emoji">üìÅ</span>
        <span>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</span>
      </a>

      <a class="drawer__link {{ 'is-active' if request.path == '/dashboard' else '' }}" href="{{ url_for('pages.dashboard') }}">
        <span class="drawer__emoji">üìä</span>
        <span>‡∏™‡∏£‡∏∏‡∏õ</span>
      </a>

      <a class="drawer__link {{ 'is-active' if request.path.startswith('/dashboard/income') else '' }}" href="{{ url_for('pages.dashboard_income') }}">
        <span class="drawer__emoji">üí∞</span>
        <span>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
      </a>

      <a class="drawer__link {{ 'is-active' if request.path.startswith('/dashboard/expense') else '' }}" href="{{ url_for('pages.dashboard_expense') }}">
        <span class="drawer__emoji">üí∏</span>
        <span>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
      </a>

      <!-- ‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô -->
      <a class="drawer__link {{ 'is-active' if request.path.startswith('/deposits/notifications') else '' }}" href="{{ url_for('pages.deposit_notifications') }}">
        <span class="drawer__emoji">üîî</span>
        <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</span>
      </a>

      <a class="drawer__link {{ 'is-active' if request.path.startswith('/docs') else '' }}" href="{{ url_for('docs.docs_list') }}">
        <span class="drawer__emoji">üßæ</span>
        <span>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>
      </a>

      <a class="drawer__link {{ 'is-active' if request.path.startswith('/customers') else '' }}" href="{{ url_for('customers.customers_list') }}">
        <span class="drawer__emoji">üë•</span>
        <span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
      </a>

      <a class="drawer__link {{ 'is-active' if request.path.startswith('/settings/company') else '' }}" href="{{ url_for('settings.company_settings') }}">
        <span class="drawer__emoji">üè¢</span>
        <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</span>
      </a>
    </nav>

    <div class="drawer__footer">
      <div class="muted" style="font-size:12px;">
        ‡∏ó‡∏¥‡∏õ: ‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π ‚ò∞ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤
      </div>
    </div>
  </aside>

  <!-- ‚úÖ Hero header -->
  <header class="topbar topbar--hero">
    <div class="topbar__inner topbar__inner--center">
      <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π -->
      <button class="hamburger" type="button" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π" data-drawer-open>
        <span class="hamburger__bar"></span>
        <span class="hamburger__bar"></span>
        <span class="hamburger__bar"></span>
      </button>

      <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Å‡∏•‡∏≤‡∏á + tagline -->
      <div class="hero-brand">
        <img
          src="{{ url_for('static', filename='icons/superflow-wordmark.png') }}"
          alt="SuperFlow"
          class="hero-brand__img"
          loading="eager"
        >
        <div class="hero-brand__tagline">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</div>
      </div>
    </div>
  </header>

  <main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div style="margin: 12px 0; display:flex; flex-direction:column; gap:8px;">
          {% for cat, msg in messages %}
            <div class="alert alert--{{ cat }}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <script>
    (function(){
      // ‚úÖ Mobile viewport height fix (PWA/Chrome/iOS): set --app-vh
      function setAppVh(){
        var vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--app-vh', vh + 'px');
      }
      setAppVh();
      window.addEventListener('resize', setAppVh);
      window.addEventListener('orientationchange', setAppVh);

      const body = document.body;
      const openBtn = document.querySelector('[data-drawer-open]');
      const closeEls = document.querySelectorAll('[data-drawer-close]');
      const drawer = document.querySelector('.drawer');

      function openDrawer(){
        body.classList.add('drawer-open');
        if(drawer) drawer.setAttribute('aria-hidden','false');
      }
      function closeDrawer(){
        body.classList.remove('drawer-open');
        if(drawer) drawer.setAttribute('aria-hidden','true');
      }

      if(openBtn){ openBtn.addEventListener('click', openDrawer); }
      closeEls.forEach(el => el.addEventListener('click', closeDrawer));

      document.addEventListener('keydown', function(e){
        if(e.key === 'Escape') closeDrawer();
      });
    })();
  </script>

  <script src="{{ url_for('static', filename='js/pwa.js') }}"></script>
  {% block scripts %}{% endblock %}
</body>
</html>
